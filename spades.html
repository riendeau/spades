<!DOCTYPE HTML>
<html>
   <head>
    <script type="text/javascript">
        window.onload = function () {
            if (!window["WebSocket"]) {
                alert("Your browser does not support WebSockets.");
                return;
            }

            var conn;
            var name = document.getElementById("name");
            var canvas = document.getElementById("canvas");
            var canvasCtx = canvas.getContext("2d");

            function clearCanvas() {
                canvasCtx.fillStyle = "green";
                canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
            }

            clearCanvas()

            document.getElementById("form").onsubmit = function () {
                if (!conn) {
                    return false;
                }
                if (!name.value) {
                    return false;
                }
                conn.send("sit " + name.value);
                name.value = "";
                return false;
            };
        
            conn = new WebSocket("ws://" + document.location.host + "/ws");
            conn.onmessage = function (evt) {
                var messages = evt.data.split('\n');
                for (var i = 0; i < messages.length; i++) {
                    console.log("Got message: " + messages[i]);

                    var segments = messages[i].split(' ')
                    if (segments[0] == "players") {
                        canvasCtx.font = "24px sans-serif";
                        clearCanvas()
                        for (var i = 1; i < segments.length; i++) {
                            if (i == 1) {
                                x = canvas.width / 2
                                y = 25
                                canvasCtx.textBaseline = "top";
                                canvasCtx.textAlign = "center";
                            } else if (i == 2) {
                                x = canvas.width / 2
                                y = canvas.height - 25
                                canvasCtx.textBaseline = "bottom";
                                canvasCtx.textAlign = "center";
                            } else if (i == 3) {
                                x = 25
                                y = canvas.height / 2
                                canvasCtx.textBaseline = "middle";
                                canvasCtx.textAlign = "left";
                            } else if (i == 4) {
                                x = canvas.width - 25
                                y = canvas.height / 2
                                canvasCtx.textBaseline = "middle";
                                canvasCtx.textAlign = "right";
                            }
                            canvasCtx.fillStyle = "white";
                            canvasCtx.fillText(segments[i], x, y);
                        }
                    } else if (segments[0] == "newhand") {
                        const img = new Image();
                        img.onload = function() {
                            canvasCtx.drawImage(img, canvas.width / 2, 100, 100, 150)
                        }
                        img.src = "images/2_of_clubs.png"
                    }
                }
            };
        };
        </script>    
   </head>

   <body>
        <form id="form">
            <label for="name">Name:</label>
            <input type="text" id="name" size="64" autofocus />
            <input type="submit" value="Send" />
        </form>
        <canvas id="canvas" width="1600" height="900"></canvas>
   </body>
</html>